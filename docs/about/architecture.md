---
layout: default
permalink: /about/architecture/
---

# Architecture

> Currently, SMDRM is able to process Twitter based datapoints.
> For more details, check the [Twitter Object Model](https://developer.twitter.com/en/docs/twitter-api/v1/data-dictionary/object-model/tweet).

The main components of SMDRM are:
* Docker - ensures consistency, reproducibility, and portability across Operating Systems
* NER annotators - recognize and [annotate](/SMDRM/about/glossary) [disaster types](/SMDRM/about/glossary),
  and places information in datapoints
* Apache Airflow - authors, schedules, and monitors [workflows](/SMDRM/about/glossary)
  as [Directed Acyclic Graphs](/SMDRM/about/glossary) (DAGs) of _tasks_ in an automated, and distributed manner.

For more info on the jargon used, check the [Glossary](/SMDRM/about/glossary).

## Diagram

![SMDRM Diagram](/SMDRM/img/smdrm-diagram.drawio.png)

## Input Data

### Format

The expected format of the input data is the zipfile archive.
The zipfile should contain at least one Newline Delimited JSON (NDJSON) file.
The NDJSON files must be located in the root of the zipfile archive.

> :warning: Sub-directory file search is not supported.

For example,

```shell
zipinfo -m data/your-file.zip

# Valid ouptut:
# Archive:  data/file.zip
# Zip file size: 235155 bytes, number of entries: 3

# ?rw-------  2.0 unx    78271 b-  0% stor 21-Dec-05 15:36 0.ndjson
# ?rw-------  2.0 unx    78271 b-  0% stor 21-Dec-05 15:36 1.ndjson
# ?rw-------  2.0 unx    78271 b-  0% stor 21-Dec-05 15:36 2.ndjson

# 3 file, 235155 bytes uncompressed, 235155 bytes compressed:  0.0%
```

### Datapoint

A datapoint (or record) is a single JSON dictionary that contains the required [fields](#fields).
There MUST be a datapoint for each new line in the files compressed in the zipfile archive.

> :information_source: The datapoint, including all required fields, can also be wrapped inside a `tweet` field.
> This is a template typically applied to keep the original record, when data is transformed.

### Fields

Table 1 shows the input data fields of a datapoint.

|Field|Type|Format|Description|Note|
|-----|----|------|-----------|----|
|`id`|int| |The unique identifier of a datapoint|A string number will be converted to integer|
|`created_at`|str|`EEE LLL dd HH:mm:ss Z yyyy`|The date and time at which the datapoint is created|Twitter based datetime format. Elasticsearch will convert this field to a date provided that it comes in this format. Therefore, make sure you convert your equivalent `created_at` field accordingly.|
|`text`|str| |The textual information to be annotated and/or geo located|Only textual information that fall inside this field will be considered. Therefore, make sure you sanitize your data accordingly.|

_Table 1. Datapoint Fields_

### Enriched Fields

Table 2 shows the additional fields generated by a DAG run.

|Field|Type|Creator|Users|Description|
|-----|----|-------|-----|-----------|
|`annotation`|dict|`extract_tweets`|`floods_annotate`|Annotation scores placeholder.|
|`annotation.floods`|float| | |Annotation score.|
|`place`|dict|`extract_tweets`|`transform_tweets`,`geocode_tweets`|Geographic attribures placeholder.|
|`place.candidates`|dict|`transform_tweets`|`geocode_tweets`|GPE, FAC, and LOC place candidates returned by DeepPavlov API.|
|`place.meta`|dict|`geocode_tweets`|`geocode_tweets`|Metadata of place candidates matched against the Global Places gazettier.|
|`place.meta.city_name`|str|`geocode_tweets`|`geocode_tweets`|The name of the city. It is populated only when place candidates are matched against the Global Places gazettier.|
|`place.meta.country_name`|str|`geocode_tweets`|`geocode_tweets`|The name of the Country.|
|`place.meta.country_code`|str|`geocode_tweets`|`geocode_tweets`|The alpha-3 code ISO 3166 Country code.|
|`place.meta.latitude`|float|`geocode_tweets`|`geocode_tweets`|Latitude of the place candidate matched against Global Places gazettier.|
|`place.meta.longitude`|float|`geocode_tweets`|`geocode_tweets`|Longitude of the place candidate matched against Global Places gazettier.|
|`place.meta.region_id`|str|`geocode_tweets`|`geocode_tweets`|The region identifier. Used internally.|
|`place.meta.region_name`|str|`geocode_tweets`|`geocode_tweets`|The GADM level 1, or 2 region name.|
|`text_clean`|str|`extract_tweets`|`transform_tweets`|Normalized textual information|

_Table 2. Enriched Fields_
